<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.19"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cppyabm: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cppyabm
   &#160;<span id="projectnumber">1.0.17</span>
   </div>
   <div id="projectbrief">An agent-based library to integrate C++ and Python</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">cppyabm Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__Users_matin_Downloads_testProjs_CppyABM_doxygen_mainpage"></a> CppyABM is a free open-source header-only library that enables agent-based modeling both C++ and Python. The model development follows similar semantics and style in both languages. Therefore, a model developed in one languages can be conveniently transferred to another. In addition, CppyABM provides essential binding tools to specifically expose certain parts of a model written in C++ for further development in Python. This enables users to take the advantage of both languages simultaneously.</p>
<h2><a class="anchor" id="autotoc_md0"></a>
Basics of design</h2>
<p>CppyABM provides three base classes of <a class="el" href="struct_env.html" title="Base class for environment.">Env</a>, <a class="el" href="struct_agent.html" title="Base class for Agent.">Agent</a>, and <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a> for agent-based modeling. These classes can be inherited and extended based on specific simulation requirements. <a class="el" href="struct_agent.html" title="Base class for Agent.">Agent</a> is designed to simulate moving objects; <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a> is for non-moving objects; and <a class="el" href="struct_env.html" title="Base class for environment.">Env</a> stores and coordinates <a class="el" href="struct_agent.html" title="Base class for Agent.">Agent</a> and <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a> objects. <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a> object can accomodate agents and heteregenious quantities within the simulation domain. There is a three-way connections between <a class="el" href="struct_env.html" title="Base class for environment.">Env</a>, <a class="el" href="struct_agent.html" title="Base class for Agent.">Agent</a>, and <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a>. <a class="el" href="struct_env.html" title="Base class for environment.">Env</a> has stored pointers to <a class="el" href="struct_agent.html" title="Base class for Agent.">Agent</a> and <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a>; <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a> has pointers to the residing <a class="el" href="struct_agent.html" title="Base class for Agent.">Agent</a> as well as <a class="el" href="struct_env.html" title="Base class for environment.">Env</a> object; and agent has pointers to host <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a> and <a class="el" href="struct_env.html" title="Base class for environment.">Env</a> object. This three-way connection enables full information retreival among the entire simulation entities. Both <a class="el" href="struct_agent.html" title="Base class for Agent.">Agent</a> and <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a> require an input argument of <a class="el" href="struct_env.html" title="Base class for environment.">Env</a> for initialization. Also, <a class="el" href="struct_agent.html" title="Base class for Agent.">Agent</a> requires an identity variable termed <a class="el" href="struct_agent.html#a40e1bf1edd0d40487d9dd1506c82c963" title="Unique ID of this class.">Agent::class_name</a> to enable multi-agent modeling; and <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a> requires a <a class="el" href="struct_m_e_s_h___i_t_e_m.html" title="A class for mesh items.">MESH_ITEM</a> object to gather three pieces of information, <a class="el" href="struct_m_e_s_h___i_t_e_m.html#a09116c3d46a08d9f3c6ef4d31497f059">MESH_ITEM::index</a>, <a class="el" href="struct_m_e_s_h___i_t_e_m.html#a0dd67df285b2feae16cabfb2e3e25610" title="Coordinates.">MESH_ITEM::coords</a>, and <a class="el" href="struct_m_e_s_h___i_t_e_m.html#a5080e5b7bd853e1f555b14b463bd0da6" title="Neighbor mesh indices.">MESH_ITEM::neighbors_indices</a>. There are few conventions that need further explanation to define an environment. Since Python requires object ownership, any object shared between C++ and Python ends, i.e. <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a> and <a class="el" href="struct_agent.html" title="Base class for Agent.">Agent</a> objects, needs to be stored in Python end and referenced as pointers in C++ end. To satisfy this requirement, two template functions of <a class="el" href="struct_env.html#a5c6226453c01cafda4bf7ce5ef59fae4" title="A template class to generate patch.">Env::generate_agent</a> and <a class="el" href="struct_env.html#ab1b7a5005339616563013aa2e826a33b">Env::generate_patch</a> are provided to manage the generation and storage of agents and patches. These functions need to be customized for each model (see <a href="#python-development">example</a>). <a class="el" href="struct_a.html">A</a> repository variable needs to be defined within Python to store created objects. Simultaneously, the objects need to be added to <a class="el" href="struct_env.html#a4e6257f4bb24cd78313ba81aa879585c" title="Agent container.">Env::agents</a> and <a class="el" href="struct_env.html#a062798e33fbeefbe3d3a9adfb4820eb6" title="Patch container.">Env::patches</a> which are the standard containers defined within C++. Using these functions, the defined agents and patches can be accessed in both C++ and Python without further measure (see <a href="#python-development">example</a>).</p>
<h2><a class="anchor" id="install"></a>
Install</h2>
<h3><a class="anchor" id="autotoc_md1"></a>
For Python development</h3>
<p>Using pip manager:</p>
<ul>
<li><code>pip install --upgrade cppyabm</code></li>
</ul>
<p>Or, download the package and in the root folder, command:</p>
<ul>
<li><code>python3 setup.py install</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md2"></a>
For C++ development</h3>
<p>The library can be also installed solely for C++ development using,</p><ul>
<li>git clone <a href="https://github.com/janursa/CppyABM">https://github.com/janursa/CppyABM</a></li>
<li>cd CppyABM &amp;&amp; mkdir build &amp;&amp; cd build</li>
<li>cmake .. -DCPP=TRUE</li>
<li>make install </li>
</ul>
<h4><a class="anchor" id="autotoc_md3"></a>
Cmake</h4>
<p>Once installed, the library can be linked using Cmake as, </p><div class="fragment"><div class="line">add_executable(your_project your_files.cpp)</div>
<div class="line">target_link_libraries(your_project  PUBLIC cppyabm::cppyabm)</div>
</div><!-- fragment --><p>The library can be also locally linked without installation by providing the <code>include</code> directory located in the root folder to the project, </p><div class="fragment"><div class="line">add_executable(your_project your_files.cpp )</div>
<div class="line">target_compile_features(your_project PUBLIC dir_to_include_folder)</div>
</div><!-- fragment --><p>To automatically clone CppyABM and link against the project, </p><div class="fragment"><div class="line">SET(CPP TRUE)</div>
<div class="line">include(FetchContent)</div>
<div class="line">FetchContent_Declare(</div>
<div class="line">      cppyabm</div>
<div class="line">      GIT_REPOSITORY https://github.com/janursa/CppyABM.git</div>
<div class="line">      GIT_TAG        master</div>
<div class="line">    )</div>
<div class="line">FetchContent_GetProperties(cppyabm)</div>
<div class="line">if(NOT cppyabm_POPULATED)</div>
<div class="line">    FetchContent_Populate(cppyabm)</div>
<div class="line">    add_subdirectory(${cppyabm_SOURCE_DIR} ${cppyabm_BINARY_DIR})</div>
<div class="line">endif()</div>
<div class="line">target_include_directories(project_name PUBLIC ${cppyabm_SOURCE_DIR}/include)</div>
</div><!-- fragment --><p>For a showcase, see <a href="https://github.com/janursa/CppyABM/tree/master/examples/Cpp" title="cpp">example</a>.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
For Python-C++ development:</h3>
<p>In order to create a mixed model using both languages of C++ and Python, in addition to CppyABM, <a href="https://github.com/pybind/pybind11" title="pybind11">pybind11</a> needs to be installed. It can be either seperately installed according to the instruction given on <a href="https://pybind11.readthedocs.io/en/stable/installing.html" title="pybind11">pybind11-installation</a>, or can be included in a project using Cmake. </p>
<h4><a class="anchor" id="cmake"></a>
Cmake</h4>
<p>The latter can be also achieved by using, </p><div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line">FetchContent_Declare(</div>
<div class="line">      cppyabm</div>
<div class="line">      GIT_REPOSITORY https://github.com/janursa/CppyABM.git</div>
<div class="line">      GIT_TAG        master</div>
<div class="line">    )</div>
<div class="line">FetchContent_GetProperties(cppyabm)</div>
<div class="line">if(NOT cppyabm_POPULATED)</div>
<div class="line">    FetchContent_Populate(cppyabm)</div>
<div class="line">    add_subdirectory(${cppyabm_SOURCE_DIR} ${cppyabm_BINARY_DIR})</div>
<div class="line">  endif()</div>
<div class="line">target_include_directories(project_name PUBLIC ${cppyabm_SOURCE_DIR}/include)</div>
</div><!-- fragment --><p>For a showcase, see <a href="https://github.com/janursa/CppyABM/tree/master/examples/Cppy" title="cppy">example</a>.</p>
<h2><a class="anchor" id="cpp-development"></a>
C++ development</h2>
<p>The model development in C++ is based on template programing to keep the internal connections between different class objects valid for the derived models. The primary layout of an agent-based model in C++ is, </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cppyabm/bases.h&quot;</span></div>
<div class="line"><span class="comment">// declare the derived classes</span></div>
<div class="line"><span class="keyword">struct </span>myEnv;</div>
<div class="line"><span class="keyword">struct </span>myAgent;</div>
<div class="line"><span class="keyword">struct </span>myPatch;</div>
<div class="line"><span class="comment">// define myEnv</span></div>
<div class="line"><span class="keyword">struct </span>myEnv: <span class="keyword">public</span> <a class="code" href="struct_env.html">Env</a>&lt;myEnv,myAgent,myPatch&gt; <span class="comment">/*Env is inherited using template arguments*/</span> {</div>
<div class="line">    <span class="comment">// just to assure that the base constructor is implemented</span></div>
<div class="line">    <span class="keyword">using</span> baseEnv = <a class="code" href="struct_env.html">Env&lt;myEnv,myAgent,myPatch&gt;</a>;</div>
<div class="line">    <span class="keyword">using</span> baseEnv::baseEnv;</div>
<div class="line">    myEnv():baseEnv() <span class="comment">/*a call to the base class&#39;s instructor*/</span>{ </div>
<div class="line">    }</div>
<div class="line">    shared_ptr&lt;myAgent&gt; <a class="code" href="struct_env.html#a5c6226453c01cafda4bf7ce5ef59fae4">generate_agent</a>(std::string);</div>
<div class="line">    shared_ptr&lt;myPatch&gt; <a class="code" href="struct_env.html#ab1b7a5005339616563013aa2e826a33b">generate_patch</a>(<a class="code" href="struct_m_e_s_h___i_t_e_m.html">MESH_ITEM</a>);</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>myPatch: <span class="keyword">public</span> <a class="code" href="struct_patch.html">Patch</a>&lt;myEnv,myAgent,myPatch&gt; {</div>
<div class="line">    <span class="keyword">using</span> basePatch = <a class="code" href="struct_patch.html">Patch&lt;myEnv,myAgent,myPatch&gt;</a>;</div>
<div class="line">    basePatch::basePatch;</div>
<div class="line">    <span class="comment">// any Patch derived class should receive these arguments</span></div>
<div class="line">    myPatch(shared_ptr&lt;myEnv&gt; <a class="code" href="namespaceenv.html">env</a>,<a class="code" href="struct_m_e_s_h___i_t_e_m.html">MESH_ITEM</a> mesh):basePatch(<a class="code" href="namespaceenv.html">env</a>,mesh)<span class="comment">/*a call to the base class&#39;s instructor*/</span>{</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>myAgent: <span class="keyword">public</span> <a class="code" href="struct_agent.html">Agent</a>&lt;myEnv,myAgent,myPatch&gt; {</div>
<div class="line">    <span class="keyword">using</span> baseAgent = <a class="code" href="struct_agent.html">Agent&lt;myEnv,myAgent,myPatch&gt;</a>;</div>
<div class="line">    <span class="keyword">using</span> baseAgent::baseAgent;</div>
<div class="line">    <span class="comment">// any derived agent should receive these arguments</span></div>
<div class="line">    myAgent(shared_ptr&lt;myEnv&gt; <a class="code" href="namespaceenv.html">env</a>,std::string agent_name):baseAgent(<a class="code" href="namespaceenv.html">env</a>,agent_name)<span class="comment">/*a call to the base class&#39;s instructor*/</span>{</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><p>For the above layout, two generator functions are, </p><div class="fragment"><div class="line">shared_ptr&lt;myAgent&gt; myEnv::generate_agent(std::string agent_name){</div>
<div class="line">    <span class="keyword">auto</span> agent_obj = make_shared&lt;myAgent&gt;(this-&gt;shared_from_this(),agent_name);</div>
<div class="line">    this-&gt;agents.push_back(agent_obj);</div>
<div class="line">    <span class="keywordflow">return</span> agent_obj;</div>
<div class="line">};</div>
<div class="line">shared_ptr&lt;myPatch&gt; myEnv::generate_patch(<a class="code" href="struct_m_e_s_h___i_t_e_m.html">MESH_ITEM</a> mesh){</div>
<div class="line">    <span class="keyword">auto</span> patch_obj = make_shared&lt;myPatch&gt;(this-&gt;shared_from_this(),mesh);</div>
<div class="line">    this-&gt;patches.insert(pair&lt;<span class="keywordtype">unsigned</span>,shared_ptr&lt;myPatch&gt;&gt;(patch_obj-&gt;index,patch_obj));</div>
<div class="line">    <span class="keywordflow">return</span> patch_obj;</div>
<div class="line">};</div>
</div><!-- fragment --><p>For a complete example in C++, check out <a href="https://github.com/janursa/CppyABM/tree/master/examples/Cpp" title="cpp">Cpp example</a>.</p>
<h2><a class="anchor" id="python-development"></a>
Python development</h2>
<p>The basic layout of an agent-based model in Python is, </p><div class="fragment"><div class="line"><span class="keyword">from</span> cppyabm.binds <span class="keyword">import</span> Env, Agent, Patch</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>myPatch(<a class="code" href="struct_patch.html">Patch</a>):</div>
<div class="line">    <span class="keyword">def </span><a class="code" href="classscript_1_1_domain.html#a5cd43481db5b844c705986c457b61cb5">__init__</a>(self,env,mesh_item):</div>
<div class="line">        Patch.__init__(self,env,mesh_item)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>myAgent (<a class="code" href="struct_agent.html">Agent</a>):</div>
<div class="line">    <span class="keyword">def </span><a class="code" href="classscript_1_1_domain.html#a5cd43481db5b844c705986c457b61cb5">__init__</a>(self,env,agent_name):</div>
<div class="line">        Agent.__init__(self,env = env,class_name = agent_name)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>myEnv(<a class="code" href="struct_env.html">Env</a>):</div>
<div class="line">    <span class="keyword">def </span><a class="code" href="classscript_1_1_domain.html#a5cd43481db5b844c705986c457b61cb5">__init__</a>(self):</div>
<div class="line">        Env.__init__(self)</div>
<div class="line">        self.agents_repo = [] <span class="comment"># local repository</span></div>
<div class="line">        self.patches_repo = [] <span class="comment"># local repository</span></div>
<div class="line">    <span class="keyword">def </span><a class="code" href="classscript_1_1_domain.html#a4fc446a62552eba6660723fb7d7bc96b">generate_agent</a>(self,agent_name):</div>
<div class="line">        agent_obj = myAgent(self,agent_name)</div>
<div class="line">        self.agents_repo.append(agent_obj) <span class="comment"># extra step</span></div>
<div class="line">        self.agents.append(agent_obj)</div>
<div class="line">        <span class="keywordflow">return</span> agent_obj</div>
<div class="line">    <span class="keyword">def </span><a class="code" href="classscript_1_1_domain.html#ae3347df9d25d9331f198cb1a0a4485ab">generate_patch</a>(self,mesh_item):</div>
<div class="line">        patch_obj = myPatch(self,mesh_item)</div>
<div class="line">        self.patches.append(patch_obj);</div>
<div class="line">        self.patches_repo.append(patch_obj) <span class="comment"># extra step</span></div>
<div class="line">        <span class="keywordflow">return</span> patch_obj</div>
<div class="line">    <span class="keyword">def </span><a class="code" href="classscript_1_1_domain.html#ac4764d7945a6f9193d3f82daef30c19f">update_repo</a>(self): <span class="comment"># to update the repository if an agent is inactive/dead</span></div>
<div class="line">        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(<a class="code" href="group__python__builtins.html#gaeff368081ac50b8fe2cc0230d96e3acb">len</a>(self.agents_repo)):</div>
<div class="line">            <span class="keywordflow">if</span> self.agents_repo[i].disappear==<span class="keyword">True</span>:</div>
<div class="line">                indices.append(i)</div>
<div class="line">        <span class="keywordflow">for</span> ele <span class="keywordflow">in</span> sorted(indices, reverse = <span class="keyword">True</span>):  </div>
<div class="line">            del self.agents_repo[ele]</div>
</div><!-- fragment --><p>Within Python, the generator functions require an additional step of storing the created objects in the local repositories. Also, the repositories needs to be updated to remove inactive agents. For a complete example in Python, check out <a href="https://github.com/janursa/CppyABM/tree/master/examples/Py" title="py">Py example</a>.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Mixed Python and C++ development</h2>
<p><a class="el" href="struct_a.html">A</a> model writen in C++ can be further extended within Python by the creation of bindings. Generally, there are two types of binding approach; exposure: to expose certain functionality already written in C++ code to Python; extention: to bind a functionality that needs to be (further) implemented in Python. We currently use <a class="el" href="namespacepybind11.html">pybind11</a> to generate Python bindings. By having the derived classes of <code>myEnv</code>, <code>myAgent</code>, and <code>myPatch</code>, the binding template looks like, </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cppyabm/bind_tools.h&quot;</span></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacebind__tools.html">bind_tools</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="examples_2_cppy_2build_2__deps_2pybind11-src_2include_2pybind11_2detail_2common_8h.html#a991baae3535d684a3df1a116d479c33f">PYBIND11_MODULE</a>(module_name, <a class="code" href="namespacetest__async.html#a01702d406cc3c32308b15cbd61e86f4d">m</a>) {</div>
<div class="line">    <span class="keyword">auto</span> bind_obj = <a class="code" href="structbind__tools_1_1_bind.html">Bind&lt;myEnv,myAgent,myPatch,tramEnv,tramAgent,tramPatch&gt;</a>(<a class="code" href="namespacetest__async.html#a01702d406cc3c32308b15cbd61e86f4d">m</a>,<span class="stringliteral">&quot;myEnv&quot;</span>,<span class="stringliteral">&quot;myAgent&quot;</span>,<span class="stringliteral">&quot;myPatch&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>where <code>module_name</code> is the Python module created for binding. The template class <code><a class="el" href="structbind__tools_1_1_bind.html">bind_tools::Bind</a></code> is the main binding tool. It receives the derived classes as template arguments together with the extension schemes (prefixed <code>tram</code>). It also receives <code>m</code>together with the binding names used for the derived classes (<code>"myEnv","myAgent","myPatch"</code>). <code>m</code> is a <code>py::module</code> object created automatically by <a class="el" href="namespacepybind11.html">pybind11</a>. The exposure schemes are <a href="https://pybind11.readthedocs.io/en/stable/advanced/classes.html" title="py">trampoline</a> classes introduced in <a class="el" href="namespacepybind11.html">pybind11</a>. CppyABM provides three trampoline classes of <code>tramEnv</code>,<code>tramAgent</code>,<code>tramPatch</code> that can be inherited in order to declare any extention to the compiler (see <a href="#extention">Extention</a>). For the exposure purposes, these classes can be directly passed to the <code><a class="el" href="structbind__tools_1_1_bind.html">bind_tools::Bind</a></code> without modification, </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cppyabm/bind_tools.h&quot;</span></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacebind__tools.html">bind_tools</a>;</div>
<div class="line"><a class="code" href="examples_2_cppy_2build_2__deps_2pybind11-src_2include_2pybind11_2detail_2common_8h.html#a991baae3535d684a3df1a116d479c33f">PYBIND11_MODULE</a>(module_name, <a class="code" href="namespacetest__async.html#a01702d406cc3c32308b15cbd61e86f4d">m</a>) {</div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="structbind__tools_1_1tram_env.html">tramEnv</a> = <a class="code" href="structbind__tools_1_1tram_env.html">tramEnv&lt;myEnv,myAgent,myPatch&gt;</a>; <span class="comment">// just use the base class</span></div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="structbind__tools_1_1tram_agent.html">tramAgent</a> = <a class="code" href="structbind__tools_1_1tram_agent.html">tramAgent&lt;myEnv,myAgent,myPatch&gt;</a>; <span class="comment">// just use the base class</span></div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="structbind__tools_1_1tram_patch.html">tramPatch</a> = <a class="code" href="structbind__tools_1_1tram_patch.html">tramPatch&lt;myEnv,myAgent,myPatch&gt;</a>; <span class="comment">// just use the base class</span></div>
<div class="line">    <span class="keyword">auto</span> bind_obj = <a class="code" href="structbind__tools_1_1_bind.html">Bind&lt;myEnv,myAgent,myPatch,tramEnv,tramAgent,tramPatch&gt;</a>(<a class="code" href="namespacetest__async.html#a01702d406cc3c32308b15cbd61e86f4d">m</a>,<span class="stringliteral">&quot;myEnv&quot;</span>,<span class="stringliteral">&quot;myAgent&quot;</span>,<span class="stringliteral">&quot;myPatch&quot;</span>);</div>
</div><!-- fragment --><p>The <code><a class="el" href="structbind__tools_1_1_bind.html">bind_tools::Bind</a></code> automatically binds the class members and functions of the base classes, i.e. <code><a class="el" href="struct_env.html" title="Base class for environment.">Env</a></code>,<code><a class="el" href="struct_agent.html" title="Base class for Agent.">Agent</a></code>, and <code><a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a></code>, as the members of the derived classes. However, the specific attributes of the derived class needs to be bind in a seperate step. For that, <code><a class="el" href="structbind__tools_1_1_bind.html">bind_tools::Bind</a></code> provides three functions of <code>get_env</code>, <code>get_agent</code> and <code>get_patch</code> to have access to the exposed classes in order to attach further class members. Two <a class="el" href="namespacepybind11.html">pybind11</a> functions of <code>def</code> and <code>def_readwrite</code> can be used to bind class functions and members, respectively. For example, assuming that <code>myEnv</code> has a function named <code>myEnvFunc</code>, and <code>myAgent</code> has a member <code>myAgentMem</code>, the following code will expose these class attibutes, </p><div class="fragment"><div class="line"><span class="keyword">auto</span> bind_obj = Bind&lt;myEnv,myAgent,myPatch,tramEnv,tramAgent,tramPatch&gt;(<a class="code" href="namespacetest__async.html#a01702d406cc3c32308b15cbd61e86f4d">m</a>,<span class="stringliteral">&quot;myEnv&quot;</span>,<span class="stringliteral">&quot;myAgent&quot;</span>,<span class="stringliteral">&quot;myPatch&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> p_env_obj = bind_obj.get_env();<span class="comment">// returns the bind env object to attach class members and functions</span></div>
<div class="line">p_env_obj.def(<span class="stringliteral">&quot;myEnvFunc&quot;</span>,&amp;myEnv::myEnvFunc); <span class="comment">// attach the function</span></div>
<div class="line"><span class="keyword">auto</span> p_agent_obj = bind_obj.get_agent(); <span class="comment">// returns the bind agent </span></div>
<div class="line">p_agent_obj.def_readwrite(<span class="stringliteral">&quot;myAgentMem&quot;</span>,&amp;myAgent::myAgentMem); <span class="comment">// attach the class member</span></div>
</div><!-- fragment --><h4><a class="anchor" id="extention"></a>
Extention</h4>
<p>For the extention purposes, the base classes of <a class="el" href="structbind__tools_1_1tram_env.html" title="Template trampoline for Env-based classes.">bind_tools::tramEnv</a>, <a class="el" href="structbind__tools_1_1tram_agent.html" title="Template trampoline for Agent-based classes.">bind_tools::tramAgent</a>, <a class="el" href="structbind__tools_1_1tram_patch.html" title="Template trampoline for Patch-based classes.">bind_tools::tramPatch</a> can be inherited and extended prior to a call to <code><a class="el" href="structbind__tools_1_1_bind.html">bind_tools::Bind</a></code>. We use <a class="el" href="namespacepybind11.html">pybind11</a> semantics for the creation of <a href="https://pybind11.readthedocs.io/en/stable/advanced/classes.html" title="py">trampoline</a>. Assuming that the class function of <code>myEnvFunc</code> belonging to <code>myEnv</code> needs to be overwritten within Python, the following trampoline can be defined, </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cppyabm/bind_tools.h&quot;</span></div>
<div class="line"><span class="keyword">using</span> tramEnv = <a class="code" href="structbind__tools_1_1tram_env.html">bind_tools::tramEnv&lt;myEnv,myAgent,myPatch&gt;</a>;  <span class="comment">// just an alias</span></div>
<div class="line"><span class="keyword">struct </span>tramMyEnv : <span class="keyword">public</span>  tramEnv{ <span class="comment">//inherit from the base class</span></div>
<div class="line">    <span class="keyword">using</span> tramEnv::tramEnv; <span class="comment">// using constructor of the parent class</span></div>
<div class="line">    <span class="keywordtype">void</span> myEnvFunc(<span class="keywordtype">int</span> input_arg)<span class="keyword"> override </span>{ <span class="comment">// declare this function for overloading within Python</span></div>
<div class="line">        <a class="code" href="pybind11_8h.html#a554e6c4e025a0a1a1d8b30998144e386">PYBIND11_OVERLOAD</a>(</div>
<div class="line">            <span class="keywordtype">void</span>, <span class="comment">// output type</span></div>
<div class="line">            myEnv, <span class="comment">// which class it belogs to    </span></div>
<div class="line">            myEnvFunc, <span class="comment">// under what name it will be called within Python</span></div>
<div class="line">            input_arg <span class="comment">//input name</span></div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><p>Once the specialized trampoline is defined, </p><div class="fragment"><div class="line"><span class="keyword">auto</span> bind_obj = Bind&lt;myEnv,myAgent,myPatch,tramEnv<span class="comment">/*the specialized trampoline**/</span>,tramMyAgent,tramPatch&gt;(<a class="code" href="namespacetest__async.html#a01702d406cc3c32308b15cbd61e86f4d">m</a>,<span class="stringliteral">&quot;myEnv&quot;</span>,<span class="stringliteral">&quot;myAgent&quot;</span>,<span class="stringliteral">&quot;myPatch&quot;</span>);</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md6"></a>
Opaque exposure</h4>
<p>By default, <a class="el" href="namespacepybind11.html">pybind11</a> converts the content of the variables based on STL containers. This prevents pass-by-reference and therefore any change made to the variable within Python is not reflected within C++. To prevent this, the STL-based variables needs to be exposed opaque. Within CppyABM, two variables of <code>agents</code> and <code>patches</code> as the default containers are based on STL. Therefore, prior to binding process, the following functions need to be executed, </p><div class="fragment"><div class="line"><a class="code" href="include_2cppyabm_2bind__tools_8h.html#a20110477fe9ad71820abeb88b2e24d72">EXPOSE_PATCH_CONTAINER</a>(myPatch); <span class="comment">// receives the derived Patch class</span></div>
<div class="line"><a class="code" href="include_2cppyabm_2bind__tools_8h.html#ad60749327698ee518d8a455525e219e6">EXPOSE_AGENT_CONTAINER</a>(myAgent); <span class="comment">// receives the derived Agent class</span></div>
<div class="line"><a class="code" href="examples_2_cppy_2build_2__deps_2pybind11-src_2include_2pybind11_2detail_2common_8h.html#a991baae3535d684a3df1a116d479c33f">PYBIND11_MODULE</a>(module_name, <a class="code" href="namespacetest__async.html#a01702d406cc3c32308b15cbd61e86f4d">m</a>)  {</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>To see an example combining all steps, see <a href="https://github.com/janursa/CppyABM/tree/master/examples/Cppy" title="cppy">binding example</a></p>
<h4><a class="anchor" id="autotoc_md7"></a>
Cmake</h4>
<p>We use Cmake for the model compilation and generation of Python binding. <a href="https://pybind11.readthedocs.io/en/stable/compiling.html" title="pybind11"><code>pybind11_add_module</code></a> provided by <a class="el" href="namespacepybind11.html">pybind11</a> takes care of a Python module creation for the given set of C++ files. See <a href="https://github.com/janursa/CppyABM/tree/master/examples/Cppy" title="cppy">binding example</a> for an example.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Visualization</h2>
<p>We use <a href="https://github.com/janursa/RTvisualize" title="RTvisualize">RTvisualize</a> for real-time visualization of the agent-based modeling. The realization of agents in 2D and 3D simulations can be done by using Scatter plot 2D and Scatter plot 3D (see <a href="https://github.com/janursa/RTvisualize" title="RTvisualize">here</a>). The heteregenous distribution of <a class="el" href="struct_patch.html" title="Base class for patch.">Patch</a> quantities within the simulation domain can be monitored used Map plot. And the evolution of a variable in the course of simulation can be monitored using Line plots. An example can be found on <a href="https://github.com/janursa/CppyABM/tree/master/examples/Py" title="cppy">here</a>.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Examples</h2>
<p>In order to demonstrate the use case of CppyABM, we design a computer model of the biological tissue growth in response to injury. For description of the problem, see the article. Implementtion files of the examples together with Cmake files can be found on <a href="https://github.com/janursa/CppyABM/tree/master/examples">here</a>.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
License</h2>
<p>This project is licensed under the MIT License - see the LICENSE.md file for details</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Authors</h2>
<ul>
<li>Jalil Nourisa</li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Useful links</h2>
<p>Familiarity with <a href="https://pybind11.readthedocs.io/en/stable/index.html" title="pybind11">pybind11</a> is helpful during the Python binding process.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Contributing to CppyABM</h2>
<p>In case of encountering a problem, pls report it as an issue or contant the author (<a href="#" onclick="location.href='mai'+'lto:'+'jal'+'il'+'.no'+'ur'+'isa'+'@g'+'mai'+'l.'+'com'; return false;">jalil<span style="display: none;">.nosp@m.</span>.nou<span style="display: none;">.nosp@m.</span>risa@<span style="display: none;">.nosp@m.</span>gmai<span style="display: none;">.nosp@m.</span>l.com</a>) </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="ttc" id="astruct_env_html_ab1b7a5005339616563013aa2e826a33b"><div class="ttname"><a href="struct_env.html#ab1b7a5005339616563013aa2e826a33b">Env::generate_patch</a></div><div class="ttdeci">virtual shared_ptr&lt; PATCH &gt; generate_patch(MESH_ITEM)</div><div class="ttdef"><b>Definition:</b> <a href="include_2cppyabm_2bases_8h_source.html#l00148">bases.h:148</a></div></div>
<div class="ttc" id="astructbind__tools_1_1_bind_html"><div class="ttname"><a href="structbind__tools_1_1_bind.html">bind_tools::Bind</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2cppyabm_2bind__tools_8h_source.html#l00261">bind_tools.h:261</a></div></div>
<div class="ttc" id="astruct_patch_html"><div class="ttname"><a href="struct_patch.html">Patch</a></div><div class="ttdoc">Base class for patch.</div><div class="ttdef"><b>Definition:</b> <a href="examples_2_cpp_2build_2__deps_2cppyabm-src_2include_2cppyabm_2bases_8h_source.html#l00028">bases.h:28</a></div></div>
<div class="ttc" id="aexamples_2_cppy_2build_2__deps_2pybind11-src_2include_2pybind11_2detail_2common_8h_html_a991baae3535d684a3df1a116d479c33f"><div class="ttname"><a href="examples_2_cppy_2build_2__deps_2pybind11-src_2include_2pybind11_2detail_2common_8h.html#a991baae3535d684a3df1a116d479c33f">PYBIND11_MODULE</a></div><div class="ttdeci">#define PYBIND11_MODULE(name, variable)</div><div class="ttdef"><b>Definition:</b> <a href="examples_2_cppy_2build_2__deps_2pybind11-src_2include_2pybind11_2detail_2common_8h_source.html#l00333">common.h:332</a></div></div>
<div class="ttc" id="astruct_m_e_s_h___i_t_e_m_html"><div class="ttname"><a href="struct_m_e_s_h___i_t_e_m.html">MESH_ITEM</a></div><div class="ttdoc">A class for mesh items.</div><div class="ttdef"><b>Definition:</b> <a href="include_2cppyabm_2mesh_8h_source.html#l00010">mesh.h:10</a></div></div>
<div class="ttc" id="anamespacebind__tools_html"><div class="ttname"><a href="namespacebind__tools.html">bind_tools</a></div><div class="ttdoc">Tools for exposing C++ types and functions to Python.</div><div class="ttdef"><b>Definition:</b> <a href="include_2cppyabm_2bind__tools_8h_source.html#l00020">bind_tools.h:20</a></div></div>
<div class="ttc" id="astruct_agent_html"><div class="ttname"><a href="struct_agent.html">Agent</a></div><div class="ttdoc">Base class for Agent.</div><div class="ttdef"><b>Definition:</b> <a href="examples_2_cpp_2build_2__deps_2cppyabm-src_2include_2cppyabm_2bases_8h_source.html#l00103">bases.h:103</a></div></div>
<div class="ttc" id="astructbind__tools_1_1tram_agent_html"><div class="ttname"><a href="structbind__tools_1_1tram_agent.html">bind_tools::tramAgent</a></div><div class="ttdoc">Template trampoline for Agent-based classes.</div><div class="ttdef"><b>Definition:</b> <a href="include_2cppyabm_2bind__tools_8h_source.html#l00061">bind_tools.h:61</a></div></div>
<div class="ttc" id="aclassscript_1_1_domain_html_a4fc446a62552eba6660723fb7d7bc96b"><div class="ttname"><a href="classscript_1_1_domain.html#a4fc446a62552eba6660723fb7d7bc96b">script.Domain.generate_agent</a></div><div class="ttdeci">def generate_agent(self, agent_name)</div><div class="ttdef"><b>Definition:</b> <a href="_py_2script_8py_source.html#l00071">script.py:71</a></div></div>
<div class="ttc" id="aclassscript_1_1_domain_html_a5cd43481db5b844c705986c457b61cb5"><div class="ttname"><a href="classscript_1_1_domain.html#a5cd43481db5b844c705986c457b61cb5">script.Domain.__init__</a></div><div class="ttdeci">def __init__(self, output_flag)</div><div class="ttdef"><b>Definition:</b> <a href="_py_2script_8py_source.html#l00063">script.py:63</a></div></div>
<div class="ttc" id="astruct_env_html_a5c6226453c01cafda4bf7ce5ef59fae4"><div class="ttname"><a href="struct_env.html#a5c6226453c01cafda4bf7ce5ef59fae4">Env::generate_agent</a></div><div class="ttdeci">virtual shared_ptr&lt; AGENT &gt; generate_agent(string class_name)</div><div class="ttdoc">A template class to generate patch.</div><div class="ttdef"><b>Definition:</b> <a href="include_2cppyabm_2bases_8h_source.html#l00151">bases.h:151</a></div></div>
<div class="ttc" id="apybind11_8h_html_a554e6c4e025a0a1a1d8b30998144e386"><div class="ttname"><a href="pybind11_8h.html#a554e6c4e025a0a1a1d8b30998144e386">PYBIND11_OVERLOAD</a></div><div class="ttdeci">#define PYBIND11_OVERLOAD(ret_type, cname, fn,...)</div><div class="ttdef"><b>Definition:</b> <a href="pybind11_8h_source.html#l02444">pybind11.h:2443</a></div></div>
<div class="ttc" id="aclassscript_1_1_domain_html_ae3347df9d25d9331f198cb1a0a4485ab"><div class="ttname"><a href="classscript_1_1_domain.html#ae3347df9d25d9331f198cb1a0a4485ab">script.Domain.generate_patch</a></div><div class="ttdeci">def generate_patch(self, mesh_item)</div><div class="ttdef"><b>Definition:</b> <a href="_py_2script_8py_source.html#l00079">script.py:79</a></div></div>
<div class="ttc" id="aclassscript_1_1_domain_html_ac4764d7945a6f9193d3f82daef30c19f"><div class="ttname"><a href="classscript_1_1_domain.html#ac4764d7945a6f9193d3f82daef30c19f">script.Domain.update_repo</a></div><div class="ttdeci">def update_repo(self)</div><div class="ttdef"><b>Definition:</b> <a href="_py_2script_8py_source.html#l00087">script.py:87</a></div></div>
<div class="ttc" id="ainclude_2cppyabm_2bind__tools_8h_html_ad60749327698ee518d8a455525e219e6"><div class="ttname"><a href="include_2cppyabm_2bind__tools_8h.html#ad60749327698ee518d8a455525e219e6">EXPOSE_AGENT_CONTAINER</a></div><div class="ttdeci">#define EXPOSE_AGENT_CONTAINER(...)</div><div class="ttdef"><b>Definition:</b> <a href="include_2cppyabm_2bind__tools_8h_source.html#l00010">bind_tools.h:9</a></div></div>
<div class="ttc" id="astructbind__tools_1_1tram_patch_html"><div class="ttname"><a href="structbind__tools_1_1tram_patch.html">bind_tools::tramPatch</a></div><div class="ttdoc">Template trampoline for Patch-based classes.</div><div class="ttdef"><b>Definition:</b> <a href="include_2cppyabm_2bind__tools_8h_source.html#l00082">bind_tools.h:82</a></div></div>
<div class="ttc" id="astructbind__tools_1_1tram_env_html"><div class="ttname"><a href="structbind__tools_1_1tram_env.html">bind_tools::tramEnv</a></div><div class="ttdoc">Template trampoline for Env-based classes.</div><div class="ttdef"><b>Definition:</b> <a href="include_2cppyabm_2bind__tools_8h_source.html#l00023">bind_tools.h:23</a></div></div>
<div class="ttc" id="anamespaceenv_html"><div class="ttname"><a href="namespaceenv.html">env</a></div><div class="ttdef"><b>Definition:</b> <a href="env_8py_source.html#l00001">env.py:1</a></div></div>
<div class="ttc" id="astruct_env_html"><div class="ttname"><a href="struct_env.html">Env</a></div><div class="ttdoc">Base class for environment.</div><div class="ttdef"><b>Definition:</b> <a href="examples_2_cpp_2build_2__deps_2cppyabm-src_2include_2cppyabm_2bases_8h_source.html#l00145">bases.h:145</a></div></div>
<div class="ttc" id="agroup__python__builtins_html_gaeff368081ac50b8fe2cc0230d96e3acb"><div class="ttname"><a href="group__python__builtins.html#gaeff368081ac50b8fe2cc0230d96e3acb">len</a></div><div class="ttdeci">size_t len(handle h)</div><div class="ttdoc">Get the length of a Python object.</div><div class="ttdef"><b>Definition:</b> <a href="pytypes_8h_source.html#l01560">pytypes.h:1560</a></div></div>
<div class="ttc" id="anamespacetest__async_html_a01702d406cc3c32308b15cbd61e86f4d"><div class="ttname"><a href="namespacetest__async.html#a01702d406cc3c32308b15cbd61e86f4d">test_async.m</a></div><div class="ttdeci">m</div><div class="ttdef"><b>Definition:</b> <a href="test__async_8py_source.html#l00005">test_async.py:5</a></div></div>
<div class="ttc" id="ainclude_2cppyabm_2bind__tools_8h_html_a20110477fe9ad71820abeb88b2e24d72"><div class="ttname"><a href="include_2cppyabm_2bind__tools_8h.html#a20110477fe9ad71820abeb88b2e24d72">EXPOSE_PATCH_CONTAINER</a></div><div class="ttdeci">#define EXPOSE_PATCH_CONTAINER(...)</div><div class="ttdef"><b>Definition:</b> <a href="include_2cppyabm_2bind__tools_8h_source.html#l00014">bind_tools.h:13</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.19
</small></address>
</body>
</html>
